---
title: "School Shooting Analysis"
author: "Omar Souabni"
format: html
editor: visual
---

Load the data

```{r}
load("data/shooting_data.rda")
df<- shooting_data

```

Table of descriptive statistics:

```{r}
#| label: tbl-sum
library(gtsummary)
summary_table <- tbl_summary(
	data = df,
	by = State,
	include = c(`Killed (includes shooter)`, `Number of Shots Fired`, `Number of Shooters`),
	label = list(
		`Killed (includes shooter)` ~ "Killed (includes shooter)",
		`Number of Shots Fired` ~ "Number of Shots Fired"
	),
	missing_text = "Missing"
)
summary_table

```

Linear regression model:

```{r}
library(broom.helpers)
model <- lm(`Killed (includes shooter)` ~ `State`, data = df)
# Create a regression table using tidy_parameters
regression_table <- tbl_regression(
	model,
	title = "Regression Analysis of Total Fatalities (Including Shooter) by State",
	tidy_fun = broom.helpers::tidy_parameters
)

# Print the regression table
regression_table

```

Histogram of 'Killed (includes shooter)

```{r}
#| label: fig1-histo
library(ggplot2)
fig_hist <- ggplot(df, aes(x = `Killed (includes shooter)`)) +
	geom_histogram(binwidth = 1, fill = "skyblue", color = "black") +
	labs(title = "Histogram of Killed (includes shooter)",
			 x = "Number of People Killed (including shooter)",
			 y = "Frequency") +
	theme_minimal()

fig_hist
```

Write a function to calculate standard deviation of 'Killed (includes shooter)' for each state

```{r}
library(dplyr)
calculate_sd_per_state <- function(data) {

	result <- data |>
		group_by(State) |>
		summarise(SD_Killed = sd(`Killed (includes shooter)`, na.rm = TRUE))


	return(result)
}
# Use the function to calculate standard deviation of 'Killed (includes shooter)' for each state
sd_per_state <- calculate_sd_per_state(df)

print(sd_per_state)
```

Shooting Incidents in Connecticut: The number of times there has been only one shooter in shooting incidents in Connecticut (CT) is `r gtsummary::inline_text(summary_table, variable = "Number of Shooters", level = "1", column = "CT")`.

The standard deviation of the number of people killed (including the shooter) in Connecticut is `r sd_per_state |> filter(State == "CT") |> pull(SD_Killed)`.


As shown in Table @tbl-sum, the descriptive statistics provide an overview of the data grouped by state.


the Figure @fig1-histo illustrates the distribution of the number of people killed, including the shooter.



